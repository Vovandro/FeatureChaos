<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Feature Chaos</title>
    <link rel="stylesheet" href="{{APP_URL}}/reset.css" />
    <link rel="stylesheet" href="{{APP_URL}}/style.css" />
    <link rel="icon" href="{{APP_URL}}/favicon.ico" />
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header__logo">
          <img src="{{APP_URL}}/logo.svg" alt="" />
          <h1>Feature Chaos {{APP_TITLE}}</h1>
        </div>
        <div>
          <button
            id="openFeatureModalBtn"
            type="button"
            class="btn btn--success"
          >
            Добавить фичу
          </button>
          <button
            id="toggleServicesBtn"
            type="button"
            aria-expanded="false"
            aria-controls="servicesOverlay"
            class="btn"
          >
            Сервисы
          </button>
        </div>
      </div>
    </header>

    <!-- Services overlay panel (initially hidden) -->
    <aside id="servicesOverlay" class="services-overlay" aria-hidden="true">
      <div
        class="services-overlay__backdrop"
        id="servicesBackdrop"
        aria-hidden="true"
      ></div>
      <div class="services-overlay__panel">
        <div class="services-overlay__header">
          <button
            id="openServiceModalBtn"
            type="button"
            class="btn btn--success"
          >
            Добавить сервис
          </button>
          <button
            id="closeServicesBtn"
            class="services-overlay__close"
            type="button"
            aria-label="Скрыть список сервисов"
          >
            ×
          </button>
        </div>
        <div class="services-overlay__content">
          <ul class="services-overlay__list" id="servicesList"></ul>
        </div>
      </div>
    </aside>

    <section class="features">
      <div class="container">
        <div class="features__toolbar">
          <div class="features__controls">
            <input
              id="featureSearch"
              class="features__search"
              type="search"
              placeholder="Поиск по названию/описанию"
              aria-label="Поиск фич"
            />
            <select
              id="serviceSelect"
              class="features__service-select"
              aria-label="Фильтр по сервису"
            >
              <option value="">Все сервисы</option>
            </select>
          </div>
          <div class="features__controls">
            <div
              class="features__status-toggle toggle-group"
              role="group"
              aria-label="Статус фич"
            >
              <button type="button" data-status="all" aria-pressed="true">
                Все
              </button>
              <button
                type="button"
                data-status="attention"
                aria-pressed="false"
              >
                Требуют внимания
              </button>
            </div>

            <div class="features__right">
              <div
                class="features__view-toggle toggle-group"
                role="group"
                aria-label="Режим отображения"
              >
                <button type="button" data-view="simple" aria-pressed="false">
                  Простой
                </button>
                <button type="button" data-view="detailed" aria-pressed="true">
                  Детальный
                </button>
              </div>
            </div>
          </div>
        </div>

        <div id="featuresEmpty" class="features__empty" hidden>
          Нет фич. Нажмите «Добавить фичу».
        </div>
        <div
          id="featuresList"
          class="features__list"
          role="list"
          aria-label="Список фич"
        >
          <div
            id="featuresLoader"
            class="features__loader"
            aria-hidden="true"
            aria-busy="false"
          >
            <div class="features__loader-backdrop"></div>
            <div
              class="features__loader-content"
              role="status"
              aria-live="polite"
            >
              <div class="spinner" aria-hidden="true"></div>
              <span class="features__loader-text">Загружаем фичи…</span>
            </div>
          </div>
        </div>

        <nav
          class="features__pagination"
          id="featuresPagination"
          aria-label="Пагинация"
        >
          <button
            type="button"
            data-page="prev"
            aria-label="Предыдущая страница"
            disabled
          >
            Назад
          </button>
          <span class="features__page-info" id="featuresPageInfo"
            >Страница 1 из 1</span
          >
          <button
            type="button"
            data-page="next"
            aria-label="Следующая страница"
            disabled
          >
            Вперед
          </button>
        </nav>

        <!-- Service list item template for Services overlay -->
        <template id="serviceListItemTemplate">
          <li data-service-id="">
            <span class="name"></span>
            <span class="services-overlay__badge" data-badge=""></span>
            <button class="btn btn--danger" data-action="delete">
              Удалить
            </button>
          </li>
        </template>

        <template id="featureItemTemplate">
          <article class="feature-card" role="listitem" data-feature-id="">
            <div class="feature-card__header">
              <div class="feature-card__badges">
                <span
                  class="feature-card__badge status"
                  data-badge="active"
                ></span>
                <span class="feature-card__deprecated-wrap">
                  <span
                    class="feature-card__badge deprecated"
                    data-badge="deprecated"
                  ></span>
                  <time
                    class="feature-card__deprecated-updated"
                    datetime=""
                  ></time>
                </span>
              </div>
              <div class="feature-card__header-left">
                <h3 class="feature-card__title"></h3>
                <p class="feature-card__description"></p>

                <p class="feature-card__range"></p>
              </div>
              <ul class="feature-card__services" aria-label="Сервисы"></ul>
            </div>
            <p class="feature-card__value"></p>
            <div class="feature-card__keys"></div>
            <div class="feature-card__actions">
              <button
                type="button"
                data-action="edit_attr"
                class="btn btn--success"
              >
                Атрибуты
              </button>
              <button type="button" data-action="edit" class="btn btn--success">
                Сервисы
              </button>
              <button
                type="button"
                data-action="delete"
                class="btn btn--danger"
              >
                Удалить
              </button>
            </div>
          </article>
        </template>

        <!-- Feature key and param templates for feature cards -->
        <template id="keyRowTemplate">
          <div class="feature-card__key">
            <div class="feature-card__key-name"></div>
            <div class="feature-card__params"></div>
          </div>
        </template>

        <template id="paramRowTemplate">
          <div class="feature-card__param">
            <span class="feature-card__param-name"></span>
            <span class="feature-card__param-value"></span>
          </div>
        </template>

        <!-- Services edit modal template -->
        <template id="servicesEditTemplate">
          <div class="modal-form services-edit">
            <h2 class="modal__title"></h2>
            <div class="modal-section">
              <ul id="svcList" class="services-edit-list"></ul>
              <div class="row">
                <input
                  id="svcName"
                  type="text"
                  placeholder="Название сервиса"
                />
                <button type="button" class="btn btn--success" id="svcAdd">
                  Добавить
                </button>
              </div>
            </div>
          </div>
        </template>

        <!-- Attributes edit modal template -->
        <template id="attributesEditTemplate">
          <div class="modal-form attrs-edit">
            <h2 class="modal__title"></h2>
            <div class="modal__saving-overlay" aria-hidden="true">
              <div class="modal__saving-box">
                <div class="spinner" aria-hidden="true"></div>
                <div class="features__loader-text">Сохраняем…</div>
              </div>
            </div>
            <div class="modal-section">
              <label class="row"
                >Базовое распределение (%):
                <input id="baseValue" type="number" min="0" max="100" />
              </label>
            </div>
            <div class="modal-section" id="keysWrap"></div>
            <div class="row">
              <input id="newKeyName" type="text" placeholder="Имя ключа" />
              <button type="button" class="btn btn--success" id="addKeyBtn">
                Добавить ключ
              </button>
            </div>
            <div class="modal__actions">
              <button type="button" class="btn btn--primary" id="attrSave">
                Сохранить
              </button>
            </div>
          </div>
        </template>

        <!-- Feature create modal template -->
        <template id="featureCreateTemplate">
          <div class="modal-form feature-create">
            <h2 class="modal__title">Новая фича</h2>
            <div class="modal-section">
              <label class="row">
                <input
                  id="createFeatureName"
                  type="text"
                  placeholder="Имя фичи"
                />
              </label>
              <label class="row">
                <textarea
                  id="createFeatureDesc"
                  placeholder="Краткое описание"
                  rows="3"
                ></textarea>
              </label>
            </div>
            <div class="modal__actions">
              <button
                type="button"
                class="btn btn--primary"
                id="createFeatureSave"
              >
                Создать
              </button>
            </div>
          </div>
        </template>

        <!-- Service create modal template -->
        <template id="serviceCreateTemplate">
          <div class="modal-form service-create">
            <h2 class="modal__title">Новый сервис</h2>
            <div class="modal-section">
              <label class="row">
                <input
                  id="createServiceName"
                  type="text"
                  placeholder="Имя сервиса"
                />
              </label>
            </div>
            <div class="modal__actions">
              <button
                type="button"
                class="btn btn--primary"
                id="createServiceSave"
              >
                Создать
              </button>
            </div>
          </div>
        </template>
      </div>
    </section>

    <div
      class="modal"
      id="modal"
      aria-hidden="true"
      role="dialog"
      aria-modal="true"
    >
      <div class="modal__backdrop" data-modal-close></div>
      <div class="modal__dialog" role="document" tabindex="-1">
        <button
          class="modal__close"
          type="button"
          aria-label="Закрыть"
          data-modal-close
        >
          &times;
        </button>
        <div class="modal__content"></div>
      </div>
    </div>

    <script>
      (function () {
        var modal = document.getElementById("modal");
        var openFeatureBtn = document.getElementById("openFeatureModalBtn");
        var openServiceBtn = document.getElementById("openServiceModalBtn");
        if (!modal) return;

        var dialog = modal.querySelector(".modal__dialog");
        var closers = modal.querySelectorAll("[data-modal-close]");

        function openModal() {
          modal.setAttribute("aria-hidden", "false");
          document.body.style.overflow = "hidden";
          if (dialog) dialog.focus();
        }
        function closeModal() {
          modal.setAttribute("aria-hidden", "true");
          document.body.style.overflow = "";
        }

        if (openFeatureBtn) openFeatureBtn.addEventListener("click", openModal);
        if (openServiceBtn) openServiceBtn.addEventListener("click", openModal);

        closers.forEach(function (el) {
          el.addEventListener("click", function () {
            closeModal();
          });
        });

        document.addEventListener("keydown", function (e) {
          if (
            e.key === "Escape" &&
            modal.getAttribute("aria-hidden") === "false"
          ) {
            closeModal();
          }
        });
      })();
    </script>
    <script src="{{APP_URL}}/main.js"></script>
  </body>
</html>
